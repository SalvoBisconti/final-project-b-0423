import Head from "next/head";
import Layout from "@/components/layout";
import CakeChart from "@/components/cakeChart";
import WalletList from "@/components/walletList";
import styles from "@/styles/pages/wallet.module.scss";

import { useContext, useState, useEffect } from "react";
import { Context } from "@/store";
import { cryptoJson } from "./api/crypto";

export default function Wallet() {
  const mode = "dark_mode";

  const [walletData, setWalletData] = useState([]);
  const [walletCrypto, setWalletCrypto] = useState([]);
  let finalWallet = [];

  const { state, dispatch } = useContext(Context);

  // const walletInLocalStorage = JSON.parse(localStorage.getItem("wallet")) || [];
  const [walletInLocalStorage, setWalletInLocalStorage] = useState(
    typeof window !== "undefined"
      ? JSON.parse(localStorage.getItem("wallet"))
      : []
  );

  if (walletInLocalStorage.length > 0) {
    finalWallet = state.cryptoListData.filter((crypto) =>
      walletInLocalStorage.includes(crypto)
    );
  } else {
    console.log("array vuoto");
  }

  useEffect(() => {
    localStorage.setItem("walletHome", [...finalWallet]);
  }, [finalWallet]);
  return (
    <>
      <Head>
        <title>Crypie - Cripto Wallet</title>
        <meta name="description" content="Generated by Crypie" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={mode}>
        <Layout>
          <div className={styles.Content}>
            <h2 className={styles.title}> MY WALLET STATUS</h2>
            <div className={styles.chartArea}>
              <CakeChart />
              <h3> SALDO: </h3>
            </div>
            <h2> Crypto </h2>
            <div className="">
              <WalletList data={[cryptoJson]} />
            </div>
          </div>
        </Layout>
      </main>
    </>
  );
}
